# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Laravel 12 + React 19 full-stack SPA using Inertia.js v2 for seamless server-client integration. Authentication is handled by Laravel Fortify (registration, email verification, 2FA, password management). The frontend uses shadcn/ui components (New York style) with Radix UI primitives and Tailwind CSS v4. Routes are type-safe via Laravel Wayfinder, which generates TypeScript functions from Laravel routes.

## Commands

### Development
```bash
composer dev          # Runs server, queue, logs, and Vite concurrently
composer dev:ssr      # Same as above but with SSR
```

### Testing
```bash
php artisan test --compact                        # Run all tests
php artisan test --compact --filter=testName       # Run specific test
php artisan test --compact tests/Feature/Auth/     # Run test directory
./vendor/bin/pest                                  # Run via Pest directly
```
Tests use in-memory SQLite (`DB_DATABASE=:memory:`) and Pest v3. Feature tests auto-use `RefreshDatabase`. Most tests should be feature tests. Create tests with `php artisan make:test --pest {name}` (add `--unit` for unit tests).

### Linting & Formatting
```bash
composer lint             # Format PHP with Pint (parallel)
composer test:lint        # Check PHP style without fixing
vendor/bin/pint --dirty   # Format only changed files
npm run lint              # ESLint with auto-fix
npm run format            # Prettier (resources/ only)
npm run types             # TypeScript type checking
```

### Building
```bash
npm run build       # Production build
npm run build:ssr   # SSR production build
npm run dev         # Vite dev server with HMR
```

### Full Test Suite
```bash
composer test       # Runs lint + all tests
```

## Architecture

### Backend (PHP/Laravel 12)
- **Routes**: `routes/web.php` (main), `routes/settings.php` (user settings). No `app/Http/Kernel.php` — middleware configured in `bootstrap/app.php`.
- **Controllers**: `app/Http/Controllers/` — use Form Request classes for validation (not inline).
- **Models**: `app/Models/` — User (with Fortify 2FA), Product. Use `casts()` method, not `$casts` property.
- **Actions**: `app/Actions/` — Fortify authentication actions.
- **Concerns**: `app/Concerns/` — shared validation rules.

### Frontend (React 19 + TypeScript)
- **Pages**: `resources/js/pages/` — Inertia page components rendered via `Inertia::render()`.
- **Components**: `resources/js/components/` — reusable React components (shadcn/ui).
- **Layouts**: `resources/js/layouts/` — app, auth, and settings layouts.
- **Actions/Routes**: `resources/js/actions/` and `resources/js/routes/` — auto-generated by Wayfinder. Import from `@/actions/` (controllers) or `@/routes/` (named routes) for type-safe routing.
- **Hooks**: `resources/js/hooks/` — custom React hooks.
- **Types**: `resources/js/types/` — TypeScript type definitions.

### Key Integrations
- **Wayfinder**: Generates TypeScript route functions from Laravel routes. Use `.form()` with Inertia `<Form>` or `form.submit(store())` with `useForm`. Parameter binding detects route keys (e.g., `{post:slug}`).
- **Inertia v2**: Supports deferred props (show skeleton/pulse while loading), infinite scrolling, polling, and prefetching.
- **Fortify**: Configured in `config/fortify.php` and `app/Providers/FortifyServiceProvider.php`.

## Conventions

- **PHP**: Use constructor property promotion, explicit return types, type hints, curly braces for all control structures. Prefer Eloquent over `DB::` facade. Use `config()` not `env()` outside config files. Add `--no-interaction` to all artisan commands.
- **Frontend**: Use existing Tailwind conventions and check project patterns. Reuse existing components before creating new ones.
- **Code style**: PHP follows Laravel preset (Pint). JS/TS follows ESLint flat config with Prettier. Run `vendor/bin/pint --dirty` before finalizing PHP changes.
- **Testing**: Every change must have tests. Use factories and their custom states when creating models in tests. Use `fake()` or `$this->faker` following existing convention.
- **Files**: Use `php artisan make:` commands to create new files. Don't create new base folders without approval. Don't change dependencies without approval.

## CI/CD

GitHub Actions runs on push/PR to main: PHP code style (Pint), frontend lint (ESLint + Prettier), and tests (Pest) on PHP 8.4/8.5 with Node 22.

## Local Environment

Served by Laravel Herd at `https://laravel.test`. Development database is MySQL (`laravel_new`), testing uses in-memory SQLite.